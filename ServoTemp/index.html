<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Servo and Temperature</title>
</head>
<body>
    <div style="margin-top: 300px">
        <span class="analogvalue" id="lightvalue">none</span>
        <span class="analogvalue" id="tempvalue">none</span>
        <span class="analogvalue" id="tempvalue2">none</span><br/>
        <button onclick="getTemp();">get Temperature</button>
        <span class="analogvalue" id="servovalue">none</span>
    </div>
<script>
    var lightdata;
    var tempdata;
	var celsius;
    var servodata = 90;
    setup();


    function loop() {
		if(cpf){
            lightdata = cpf.get("a0");
            tempdata = cpf.get("a1");
            celsius = toCelsius(tempdata);
            document.getElementById("lightvalue").innerHTML = lightdata;
            document.getElementById("tempvalue").innerHTML = celsius;

           if(lightdata <= 400){
				servodata =10;
                cpf.request('["servo_pos_speed", 4, 10]');
            }
            else if(lightdata <= 600 && lightdata > 400){
				servodata = 90;
                cpf.request('["servo_pos_speed", 4, 90]');
            }
            else{
                servodata = 170;
				cpf.request('["servo_pos_speed", 4, 170]');
            }
			
			document.getElementById("servovalue").innerHTML = servodata;

            // 慢速移動Servo
            // cpf.request('["servo_pos_speed", 8, 60, 30]');
            //["servo_pos_speed", < 2~13 >, < targetPos >, < delay >]
            // 快速移動Servo
            //cpf.request('["servo_pos", 8, 60]');
            //["servo_pos", < 2~13 >, < targetPos >]

            // cpf.request('["tone_play", 6, 261, 300],["sleep", 300],["tone_play", 6, 293, 300],["sleep", 300],["tone_play", 6, 329, 300],["sleep", 300],["tone_play", 6, 349, 300],["sleep", 300],["tone_play", 6, 392, 300],["sleep", 300],["tone_play", 6, 440, 300],["sleep", 300],["tone_play", 6, 493, 300],["sleep", 300],["tone_play", 6, 349, 523]'); 
            //["tone_play", < 2~13 > , < frequency >, < delay >]
        }
		setTimeout(loop, 1000);
	}
	loop();

    function getTemp(){
        tempdata = cpf.get("a1");
        celsius = toCelsius(tempdata);
        document.getElementById("tempvalue2").innerHTML = celsius;
    }

    function getLight(){
        tempdata = cpf.get("a0");
        celsius = toCelsius(tempdata);
        document.getElementById("lightvalue").innerHTML = celsius;
    }
    


    // Temperature
    function toCelsius(value) {
		var resistance = parseFloat((1023-value) * 10000 / value);
		var temperature = 1 / (Math.log(resistance / 10000) / 3975+1 / 298.15) - 273.15;
		
		return temperature.toFixed(2);
	}

    function setup(){
        if(cpf){
            //Temperature
            cpf.setPinMode('["resetPin"],["setPinMode", "analog", 0, "INPUT"]');
            //Servo
            cpf.setPinMode('["resetPin"],["servo_init", 4, 90, 500 , 2400]');
               //["servo_init", < 2~13 >, < pos >, < minPulse >, < maxPulse >]
            //Buzzer
            //cpf.setPinMode('["resetPin"],["setPinMode", "digital", 6, "TONE"] ');
        }
    }
</script>

</body>
</html>
