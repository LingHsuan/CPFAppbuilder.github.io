<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Servo and Temperature</title>
</head>
<body>
    <span class="analogvalue" id="tempvalue">none</span>
    <span class="analogvalue" id="tempvalue2">none</span>
    <button onclick="getTemp();">get Temperature</button>
    
<script>
    var tempdata;
	var celsius;
    setup();

    function loop() {
		if(cpf){
            tempdata = cpf.get("a0");
            celsius = toCelsius(tempdata);
            document.getElementById("tempvalue").innerHTML = celsius;

//             if(celsius < 20){
//                 cpf.request('["servo_pos", 8, 30]');
//             }
//             else if(celsius <25){
//                 cpf.request('["servo_pos", 8, 90]');
//             }
//             else{
//                 cpf.request('["servo_pos", 8, 150]');
//             }

            // 慢速移動Servo
            // cpf.request('["servo_pos_speed", 8, 60, 30]');
            //["servo_pos_speed", < 2~13 >, < targetPos >, < delay >]
            // 快速移動Servo
             cpf.request('["servo_pos", 8, 60]');
            //["servo_pos", < 2~13 >, < targetPos >]

            // cpf.request('["tone_play", 6, 261, 300],["sleep", 300],["tone_play", 6, 293, 300],["sleep", 300],["tone_play", 6, 329, 300],["sleep", 300],["tone_play", 6, 349, 300],["sleep", 300],["tone_play", 6, 392, 300],["sleep", 300],["tone_play", 6, 440, 300],["sleep", 300],["tone_play", 6, 493, 300],["sleep", 300],["tone_play", 6, 349, 523]'); 
            //["tone_play", < 2~13 > , < frequency >, < delay >]
        }
		setTimeout(loop, 1000);
	}
	loop();

    function getTemp(){
        tempdata = cpf.get("a0");
        celsius = toCelsius(tempdata);
        document.getElementById("tempvalue2").innerHTML = celsius;
    }
    


    // Temperature
    function toCelsius(value) {
		var resistance = parseFloat((1023-value) * 10000 / value);
		var temperature = 1 / (Math.log(resistance / 10000) / 3975+1 / 298.15) - 273.15;
		
		return temperature.toFixed(2);
	}

    function setup(){
        if(cpf){
            //Temperature
            cpf.setPinMode('["resetPin"],["setPinMode", "analog", 0, "INPUT"]');
            //Servo
            cpf.setPinMode('["resetPin"],["servo_init", 8, 90, 500 , 2400]');
               //["servo_init", < 2~13 >, < pos >, < minPulse >, < maxPulse >]
            //Buzzer
            cpf.setPinMode('["resetPin"],["setPinMode", "digital", 6, "TONE"] ');
        }
    }
</script>

</body>
</html>
